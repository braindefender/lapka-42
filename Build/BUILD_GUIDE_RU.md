# Инструкция по сборке

## Список необходимых деталей

| Деталь          | Кол-во | Описание                  | Ссылка                                  |
| --------------- | ------ | ------------------------- | --------------------------------------- |
| PCB             | 2      | Основная плата            |                                         |
| MCU             | 2      | Контроллер nRF52840       | [Ссылка](#nrf52840-mcu)                 |
| Батарея         | 2      | Размер 401230, 120-150mAh | [Ссылка](#401230-battery)               |
| Тактовая кнопка | 2      | 4x4x1.5mm button          | [Ссылка](#tactile-button)               |
| SMD Диоды       | 42     | 1N4148 (SOD-323)          | [Ссылка](#1n4148-sod-323-diode)         |
| Hot-Swap сокеты | 42     | Kailh PG1350              | [Ссылка](#kailh-pg1350-hot-swap-socket) |
| Свитчи          | 42     | Kailh Choc v1 / v2        | [Ссылка](#kailh-choc-v1--v2)            |
| Кейкапы         | 42     | Choc-Spacing              | [Ссылка](#choc-spacing-keycaps)         |
| Гребёнка        | 9×2×2  | (Опционально)             | [Ссылка](#hot-swap-pin-header)          |

| Название      | Кол-во | Описание                  |
| ------------- | ------ | ------------------------- |
| `Frame_Main`  | 2      | Корпус для тайп-кластера  |
| `Frame_Thumb` | 2      | Корпус для тамб-кластера  |
| `Cover`       | 2      | Крышка для батареи/ресета |
| `Bottom`      | 2      | Нижняя часть корпуса      |

## Ссылки на детали

### 401230 Battery
Можно купить практически где угодно. На OZON их куча. Такие АКБ стоят в видео-регистраторах.
Не ведитесь на большую заявленную ёмкость (200-250+), зачастую там всего 120-150mAh.

- [OZON | MyDigitals](https://www.ozon.ru/product/akkumulyator-batareya-401230-120mah-3-7v-30h12h4-mm-1812801020/)
- [AliExpress | EasyLander](https://aliexpress.ru/item/1005006119986947.html?sku_id=12000048850576528)

### nRF52840 MCU
> Стоит обратить внимание на [отличия коннектора USB-C](#разница-mcu-usb-c)

- [AliExpress | TENSTAR Store](https://aliexpress.ru/item/1005006282506884.html)
- [AliExpress | Simple Robot Store](https://aliexpress.ru/item/1005008896713501.html)

### Hot-Swap Pin Header
Это полностью опционально. Вы можете припаять контроллер к плате с помощью комплектной гребёнки.
Однако hot-swap гребёнку паять будет удобнее, даже если вы не планируете использовать hot-swap.

- [AliExpress | EQV Official Store](https://aliexpress.ru/item/1005007465756012.html)

### 1N4148 SOD-323 Diode
- [AliExpress | TZT teng Official Store](https://aliexpress.ru/item/1005008443360532.html)

### Tactile Button
- [AliExpress | LOSUYINE Store](https://aliexpress.ru/item/32815925814.html)
- [AliExpress | KRYOND Electronic Store](https://aliexpress.ru/item/1005009981759314.html)

### Kailh PG1350 Hot-Swap Socket
- [AliExpress | Dafu Store](https://aliexpress.ru/item/1005009449387695.html)
- [AliExpress | KBDiy Switch Store](https://aliexpress.ru/item/1005004916925259.html)

### Kailh Choc v1 / v2
Настоятельно рекомендую изучить [базу свитчей от Watchman'а](https://aroum.github.io)

### Choc-Spacing Keycaps
> На данный момент, на рынке очень мало кейкапов для Choc v2 с Choc-спейсингом. Из open-source вариантов, я могу предложить только [KLP Lamé](https://github.com/braindefender/KLP-Lame-Keycaps).

- [GitHub | KLP Lamé](https://github.com/braindefender/KLP-Lame-Keycaps)
- [GitHub | GammaCaps](https://github.com/sqdbruh/gammacaps)
- [BeeKeeb | Tai-Hao THCS](https://showcase.beekeeb.com/choc-spaced-chocv2-keycaps/)

## Инструкция

1. Проверьте, что у вас имеются все необходимые детали для сборки, а также паяльник, паяльная паста или припой (с паяльной пастой будет значительно удобнее).

2. Отделите платы от транспортировочных перемычек. Это можно сделать просто аккуратно отломив их, придерживая пальцами недалеко от места излома.

![](./Assets/build_01.jpg)

3. Нанесите паяльную пасту на площадки для hotswap-сокетов и припаяйте сами сокеты. Сокет нужно располагать так, чтобы его большая часть смотрела в сторону, а маленькая в центр.

![](./Assets/build_02.jpg)

> Обычно, я наношу пасту на все площадки сокетов, затем устанавливаю сокеты и сначала припаиваю по одному правому пину каждого сокета (справа налево), придерживая пальцем сокет. После чего, поворачиваю плату на 180° и повторяю тот же процесс для левого пина сокета. Так получается достаточно быстро и без смещения припаять все сокеты.

![](./Assets/build_03.jpg)

4. Нанесите паяльную пасту на площадки для SMD-диодов и припаяйте сами диоды. Диоды нужно располагать в соответствии с [маркировкой](#маркировка-диодов-1n4148w-t4). Две полоски на корпусе диода означают положение **катода** — поэтому располагаем диоды так, чтобы эти две полоски смотрели в сторону контроллера.

![](./Assets/build_04.jpg)

5. Подготовьте гребёнку. Чтобы отмерить то, как её нужно надломить, просуньте пины в отверстия с любой стороны платы. Должно получиться ровно 9 пинов. Нам понадобится два таких отрезка.

![](./Assets/build_05.jpg)

6. Нанесите паяльную пасту в отверстия для гребёнки, установите гребёнку в отверстия так, чтобы пластиковая часть находилась с противоположной стороны от диодов/сокетов. Можно припаять крайние пины, чтобы она оставалась в закреплённом положении. В процессе пайки, паста, оставшаяся на штырьках, сама спустится на площадку.

![](./Assets/build_06.jpg)

7. После того, как были припаяны hotswap-сокеты, диоды и гребёнка, плату нужно тщательно отмыть от флюса. Я делаю это с помощью изопропилового спирта, протирая площадки зубной щёткой или жёсткой кисточкой. После мойки оставляем плату в тёплом месте, чтобы весь спирт или вода высохли. Пока одна плата сушится, можно приступать к пайке второй половинки.

8. Убедитесь, что контроллеры nRF52840 работают исправно. Для этого можете прошить в них [тестовую прошивку](https://github.com/braindefender/lapka-zmk-config/tree/lapka-42-test), попарно замыкать контакты строк и столбцов и смотреть как в [key-test](https://key-test.ru) нажимаются клавиши. Либо, можете на свой страх и риск пропустить этот пункт. Но выпаивать неисправный контроллер — последнее, что хотелось бы делать, поэтому, лучше «перебздеть».

9. Установите контроллер nRF52840 на штырьки так, чтобы SMD-компоненты смотрели в сторону платы. Для антенны, USB Type-C коннектора и пары (транзисторов?) в плате предусмотрены вырезы. После установки контроллера, нанесите паяльную пасту на контакты и припаяйте его. Будьте аккуратны, контроллер при пайке нужно держать ровно, иначе он будет выпирать одной из своих сторон за корпус.

10. Нанесите паяльную пасту на площадки для тактовой кнопки и батареи и припаяйте эти элементы. Чёрный провод — это «минус», красный — это «плюс». Тактовая кнопка тоже имеет «полярность», располагайте её горизонтально.

11. После того, как все элементы припаяны, можно установить части корпуса и вставить свитчи в сокеты. Готово. Теперь можно [прошить](https://github.com/braindefender/lapka-zmk-config/tree/lapka-42) клавиатуру и пользоваться ей.

## Заметки

### Разница MCU USB-C

![](./Assets/nRF52840-usb-c-difference.jpg)

[nRF52840](https://github.com/joric/nrfmicro/wiki/Alternatives#supermini-nrf52840) продаётся в нескольких вариантах, среди которых есть отличие в USB Type-C коннекторе. Например, платы из Simple Robot Store имеют завышенный USB-C, в то время как большинство плат от других продавцов/производителей — обычные. Корпус для MCU поддерживает и тот, и другой тип.

### Маркировка диодов 1N4148W (T4)

Одной или несколькими полосками на корпусе диода отмечен катод.

![](./Assets/1N4148W-diode.jpg)
